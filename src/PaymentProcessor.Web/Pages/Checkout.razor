@page "/checkout"
@using PaymentProcessor.Web.Shared.Crypto
@using YourApp.Shared.Crypto

<h3>Checkout USDT/USDC</h3>

<CryptoPaymentWatcher Request="@Req"
                      Timeout="@TimeSpan.FromMinutes(20)"
                      OnPaymentConfirmed="HandlePaid" />

@if (!string.IsNullOrEmpty(DownloadUrl))
{
    <div class="alert alert-success mt-3">
        Â¡Pago confirmado! <a href="@DownloadUrl" target="_blank">Descargar producto</a>
    </div>
}

@code {
    private string? DownloadUrl;

    // Only set required fields, let the watcher fill the rest from config
    private PaymentRequest Req = new PaymentRequest()
    {
        OrderId = Guid.NewGuid().ToString(),
        ExpectedAmount = 10.00m,
    };

    private Task HandlePaid(PaymentResult result)
    {
        DownloadUrl = $"https://tu-servidor.com/download?order={Req.OrderId}&sig=...";
        Console.WriteLine($"Pago OK: {result.TransactionHash} {result.Amount} {result.From} -> {result.To}");
        StateHasChanged();
        return Task.CompletedTask;
    }
}